---------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  B:\_YZU\01_teaching\investment\code\cm522\log/04_bm sorting.log
  log type:  text
 opened on:   4 Sep 2022, 17:25:23

. 
. * first, change pwd to class folder
. use "data/Main.dta" , clear

. 
. * merge with Bm
. merge 1:1 permno yyyymm using "data/Bm.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       275,011
        from master                    52,885  (_merge==1)
        from using                    222,126  (_merge==2)

    matched                         4,781,622  (_merge==3)
    -----------------------------------------

. keep if _merge == 3
(275,011 observations deleted)

. drop _merge

. 
. * statistics of bm
. su bm

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          bm |  2,718,665   -.6055485    1.017166  -13.05905   5.968292

. 
. * Fama-Macbeth regression
. asreg ret beta log_me bm, fmb newey(6)

Fama-MacBeth Two-Step procedure (Newey SE)       Number of obs     =   2566441
(Newey-West adj. Std. Err. using lags(6))        Num. time periods =       739
                                                 F(  3,   738)     =    158.56
                                                 Prob > F          =    0.0000
                                                 avg. R-squared    =    0.0975
                                                 Adj. R-squared    =    0.0952
------------------------------------------------------------------------------
             |              Newey-FMB
         ret |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        beta |    .379116   .2853598     1.33   0.184    -.1810977    .9393298
      log_me |   .0232035   .0393865     0.59   0.556    -.0541195    .1005264
          bm |  -1.712476   .0786926   -21.76   0.000    -1.866964   -1.557988
       _cons |  -.2617234   .2697929    -0.97   0.332    -.7913763    .2679296
------------------------------------------------------------------------------

. 
. * sorting
. astile g_bm = bm, nq(10) by(yyyymm)

. 
. * statistics
. tab g_bm, su(bm)

         10 |
  quantiles |            Summary of bm
      of bm |        Mean   Std. Dev.       Freq.
------------+------------------------------------
          1 |  -2.4883763   .86600106     272,216
          2 |  -1.5212093   .40620491     271,827
          3 |  -1.1259347   .35730478     271,901
          4 |  -.84630234   .33158172     271,820
          5 |  -.61824519   .31367103     271,754
          6 |  -.41716823     .300514     271,982
          7 |  -.22308632   .29384477     271,900
          8 |  -.00880542   .29670745     271,821
          9 |   .27035098   .31884291     271,907
         10 |   .92729914   .59971656     271,537
------------+------------------------------------
      Total |  -.60554847   1.0171661   2,718,665

. 
. * 10 portfolio returns over time
. collapse (mean) ret, by(g_bm yyyymm)

. tab g_bm, su(ret)

         10 |
  quantiles |        Summary of (mean) ret
      of bm |        Mean   Std. Dev.       Freq.
------------+------------------------------------
          1 |    3.991953   7.7238213         739
          2 |   2.7949678   6.4656724         715
          3 |   2.2064639   5.9502682         718
          4 |   1.8536719    5.580858         716
          5 |   1.5007237   5.4148315         715
          6 |   1.1662255   5.4188423         726
          7 |   .84978417   5.4448731         716
          8 |   .41928087   5.6623836         718
          9 |  -.18125869   6.2081806         715
         10 |  -2.4120272   7.8008836         715
------------+------------------------------------
      Total |   1.2282653   6.4456266       7,193

. 
. * close log file
. log close
      name:  <unnamed>
       log:  B:\_YZU\01_teaching\investment\code\cm522\log/04_bm sorting.log
  log type:  text
 closed on:   4 Sep 2022, 17:26:12
---------------------------------------------------------------------------------------------------------
